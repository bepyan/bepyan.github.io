---
title: 'Drag ì´ë²¤íŠ¸ ë½€ê°œê¸°'
description: 'ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ì´ Reactì—ì„œ elementë¥¼ ì»¤ì„œë¡œ ì›€ì§ì´ê²Œ í•˜ì!!!'
tags:
  - Next.js
  - React
  - DOM
draft: false
date: 2022-10-01
---

dragê´€ë ¨í•´ì„œ ì¢‹ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì´ ìˆì§€ë§Œ ìˆœìˆ˜í•˜ê²Œ êµ¬í˜„í•´ë³´ê³  ì‹¶ë‹¤.
ì•„ë˜ì˜ ìŠ¤í™ìœ¼ë¡œ êµ¬í˜„ì„ ì‹œì‘í•´ë³´ì ğŸ„ğŸ»â€â™‚ï¸

- `NextJS` `React`
- `Typescript`
- `tailwindcss`

---

## TL;DR
> `mousedown`ì—ì„œ `mousemove` `mouseup` ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•œë‹¤.
> `mousemove`ì—ì„œ `event.pageX`ì™€ `mousedown`ì˜ `event.pageX` ì°¨ì´ë¥¼ í™œìš©í•´ ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì´ë™ì‹œí‚¨ë‹¤.
> `mouseup`ì—ì„œ `mousemove` ì´ë²¤íŠ¸ë¥¼ í•´ì œì‹œí‚¨ë‹¤.

---

## ì‚¬ì „ ì§€ì‹ â€” DOM ì´í•´

ë§ˆìš°ìŠ¤ì˜ ì›€ì§ì„ ë°”íƒ•ìœ¼ë¡œ elementì˜ ìœ„ì¹˜ë¥¼ ì´ë™ì‹œì¼œì•¼ í•œë‹¤.
ë”°ë¼ì„œ ë§ˆìš°ìŠ¤ ê´€ë ¨ ì´ë²¤íŠ¸ë¥¼ ì˜ ì´í•´í•´ì•¼ í•œë‹¤.

`mousedown` â€” ë§ˆìš°ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸
`mousemove` â€” ë§ˆìš°ìŠ¤ ì´ë™ ì´ë²¤íŠ¸
`mouseup` â€” ë§ˆìš°ìŠ¤ í´ë¦­ í•´ì œ ì´ë²¤íŠ¸
[https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent](https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent)

ìœ„ DOM ì´ë²¤íŠ¸ë¥¼ í™œìš©í•˜ì—¬ ë§ˆìš°ìŠ¤ì˜ ì •ë³´ë¥¼ ë°›ì•„ ì˜¬ ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.
ê·¸ë ‡ë‹¤ë©´ **MouseEvent**ëŠ” ì–´ë–¤ ì†ì„±ì„ ê°€ì§€ê³  ìˆì„ê¹Œ?
ë¹„ìŠ· ë¹„ìŠ·í•˜ê²Œ ë³´ì´ëŠ” ì¹œêµ¬ë“¤ì´ ë§ì€ë° ì°¨ì´ë¥¼ ë¹„êµí•´ë³´ì.

| Properties     |                                                                                                    |
| -------------- | -------------------------------------------------------------------------------------------------- |
| **x, clientX** | in local (DOM content) coordinates.<br />eventê°€ ë°œìƒë˜ëŠ” element ê¸°ì¤€ìœ¼ë¡œ ìœ„ì¹˜ë¥¼ ì‚°ì •í•œë‹¤.        |
| **pageX**      | relative to the whole document.<br />page documentì„ ê¸°ì¤€ìœ¼ë¡œ ìœ„ì¹˜ë¥¼ ì‚°ì •í•œë‹¤.                     |
| **screenX**    | in global (screen) coordinates.<br />ë” ë‚˜ì•„ê°€ ë“€ì–¼ ëª¨ë‹ˆí„°ì˜ ì£¼ ëª¨ë‹ˆí„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìœ„ì¹˜ë¥¼ ì‚°ì •í•œë‹¤. |

ë¬´ì—‡ì„ ì‚¬ìš©í•˜ë˜ í¬ê²Œ ë¬¸ì œë  ê²ƒì´ ì—†ì–´ë³´ì—¬ screenXì„ ì‚¬ìš©í•´ë³´ì.

---

## ê¸°ë³¸ ì›ë¦¬ â€” Drag ì´ë²¤íŠ¸ ë“±ë¡

ê·¸ë ‡ë‹¤ë©´ DOM ì´ë²¤íŠ¸ë¥¼ í™œìš©í•˜ì—¬ ë§ˆìš°ìŠ¤ì˜ ì›€ì§ì„ì„ ì¶”ì í•´ë³´ì!
ì£¼ìš” ë¡œì§ì€ ì•„ë˜ì™€ ê°™ë‹¤.

1. í´ë¦­ì‹œ(`onMouseDown`) documentì— `mousemove` `mouseup` ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•œë‹¤.
2. í´ë¦­ëœ ìƒíƒœì—ì„œ ë§ˆìš°ìŠ¤ë¥¼ ì›€ì§ì¼ì‹œ `mousemove`ì— ë“±ë¡ ëœ í•¨ìˆ˜ê°€ ê³„ì† í˜¸ì¶œëœë‹¤.
3. `mouseup` ì´ë²¤íŠ¸ì—ì„œ `mousemove` ì´ë²¤íŠ¸ë¥¼ ì œê±°í•œë‹¤.

```jsx
<div
  onMouseDown={() => {
    // 2ï¸âƒ£
    const mouseMoveHandler = (e: MouseEvent) => {
      console.log(`mouse move x:${e.screenX} y:${e.screenY}`);
    };

    // 3ï¸âƒ£
    const mouseUpHandler = (e: MouseEvent) => {
      console.warn(`>>>> mouse up x:${e.screenX} y:${e.screenY}`);
      document.removeEventListener('mousemove', mouseMoveHandler);
    };

    // 1ï¸âƒ£
    document.addEventListener('mousemove', mouseMoveHandler);
    document.addEventListener('mouseup', mouseUpHandler, { once: true });
    // mouseup ì´ë²¤íŠ¸ëŠ” í•œë²ˆë§Œ ì‹¤í–‰ë˜ë©´ ë˜ê¸°ì— { once: true } ì˜µì…˜ì„ ì¶”ê°€í•´ì¤€ë‹¤.
  }}
/>
```

![](https://velog.velcdn.com/images/bepyan/post/40730059-40c1-4a9c-8fc9-c9abfd59c82d/image.gif)

---

## ê¸°ë³¸ ì‘ìš© â€” Drag ìœ„ì¹˜ ì´ë™

ë§ˆìš°ìŠ¤ì˜ ì›€ì§ì„ì„ ì¶”ì í•˜ì˜€ìœ¼ë‹ˆ,
ì´ì œ ì´ë¥¼ í™œìš©í•˜ì—¬ elementë¥¼ dragí•´ì„œ ìœ„ì¹˜ë¥¼ ì›€ì§ì—¬ë³´ì!

1. elementì˜ `position` ìƒíƒœë¥¼ ì •ì˜í•œë‹¤.
2. í´ë¦­(`mousedown`) ì´ë²¤íŠ¸ ë°œìƒì‹œì˜ ì»¤ì„œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ,
   ì´ë™(`mousemove`) ì´ë²¤íŠ¸ì—ì„œ **ìƒëŒ€ì ìœ¼ë¡œ ì´ë™í•œ ê±°ë¦¬(deltaX, deltaY)**ë¥¼ ê³„ì‚°í•œë‹¤.
3. `position` ìƒíƒœë¥¼ ë³€ê²½í•˜ì—¬ elementë¥¼ ì›€ì§ì´ê²Œ í•œë‹¤.

```tsx
// 1ï¸âƒ£
const [{ x, y }, setPosition] = useState({
  x: 0,
  y: 0,
});

return (
  <div>
    <div
      style={{ transform: `translateX(${x}px) translateY(${y}px)` }}
      onMouseDown={(clickEvent: React.MouseEvent<Element, MouseEvent>) => {
        const mouseMoveHandler = (moveEvent: MouseEvent) => {
          // 2ï¸âƒ£
          const deltaX = moveEvent.screenX - clickEvent.screenX;
          const deltaY = moveEvent.screenY - clickEvent.screenY;

          // 3ï¸âƒ£
          setPosition({
            x: x + deltaX,
            y: y + deltaY,
          });
        };

        const mouseUpHandler = () => {
          document.removeEventListener('mousemove', mouseMoveHandler);
        };

        document.addEventListener('mousemove', mouseMoveHandler);
        document.addEventListener('mouseup', mouseUpHandler, { once: true });
      }}
    />
  </div>
);
```

![](https://velog.velcdn.com/images/bepyan/post/5c38729e-f30e-406f-92e6-de16918f87c0/image.gif)

(TIP)
ì—ë‹ˆë©”ë‹ˆì…˜ ì¸í„°ë™ì…˜ì„ ê³ ë ¤í•  ê²½ìš°,
ì‹¤ì œ dragí•  element(`Box`)ë¥¼ divë¡œ ì”Œì›Œì„œ ì´ë²¤íŠ¸, styleë¥¼ ë“±ë¡ ê²ƒì´ ì¢‹ë‹¤.

`transition: transform` ê²½ìš° ì›ì¹˜ì•Šê²Œ ì—ë‹ˆë©”ì´ì…˜ íš¨ê³¼ê°€ ì ìš©ë  ìˆ˜ ìˆë‹¤.

```jsx
<div
	style={...}
	onMouseDown={...}
>
	<Box />
</div>
```

---

## ì‹¬í™” ì‘ìš© â€” **Drag Boundary**

dragí•  ë•Œ íŠ¹ì • ì˜ì—­(boundary)ì„ ë²—ì–´ë‚˜ì§€ ì•Šê¸¸ ì›í•  ìˆ˜ ìˆë‹¤.
ìœ„ 2ë²ˆ ê³¼ì •, `mousemove`ì´ë²¤íŠ¸ì—ì„œ **íŠ¹ì • ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ì§€ ì•Šë„ë¡ ì œí•œ**í•˜ë©´ ëœë‹¤.

![](https://velog.velcdn.com/images/bepyan/post/ac92e9bf-fce7-48b5-8a83-acc04b183878/image.png)

#### 1. boundary, box elementì˜ í¬ê¸°ë¥¼ ì–»ëŠ”ë‹¤.

[getBoundingClientRect](<(https://developer.mozilla.org/ko/docs/Web/API/Element/getBoundingClientRect)>)ì„ í™œìš©í•˜ì—¬ elementì˜ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.

```tsx
const boundary = boundaryRef.current.getBoundingClientRect();
const box = boxRef.current.getBoundingClientRect();
// x, y, width, height
```

#### 2. dragí•  ìˆ˜ ìˆëŠ” ê²½ê³„(minx, maxx, miny, maxy)ë¥¼ ê³„ì‚°í•œë‹¤.

elementë¥¼ ë†“ëŠ” ê¸°ì¤€ì— ë”°ë¼ boundaryê°€ ë‹¬ë¼ì§€ëŠ”ë° ìƒí™©ì— ë§ê²Œ ì˜ ê³„ì‚°í•˜ë©´ ëœë‹¤.

<br />
<br />

drag elementì´ **ì¤‘ì•™ ì •ë ¬**ë˜ì—ˆë‹¤ê³  ìƒê°í•´ë³´ì.
ê¸°ë³¸ boxì˜ ìœ„ì¹˜ëŠ” `x:0, y:0`(ì¤‘ì•™) ì´ë‹¤.

ë”°ë¼ì„œ elementì˜ ì œí•œ ë²”ìœ„ë¥¼ ê³„ì‚°í•´ë³´ë©´

![](https://velog.velcdn.com/images/bepyan/post/26ef16ac-fa25-4c96-b2f7-da4bf5759f0c/image.png)![](https://velog.velcdn.com/images/bepyan/post/332fa024-b6ec-46fe-9b0e-40527d11e101/image.png)

ì¢Œì¸¡ ë = `-boundary.width/2` + `box.width/2` + `margin`
ìš°ì¸¡ ë = `boundary.width/2` - `box.width/2` - `margin`

ë¨¼ì €, ë²”ìœ„ë¥¼ ì–»ëŠ” ìœ í‹¸í•¨ìˆ˜ë¥¼ ë§Œë“¤ë©´ ì½”ë“œê°€ ë” ê¹”ë”í•´ì§ˆ ê²ƒ ê°™ë‹¤.

```tsx
const inrange = (v: number, min: number, max: number) => {
  if (v < min) return min;
  if (v > max) return max;
  return v;
};
```

ì½”ë“œì— ì ìš©í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.

```tsx
const BOUNDARY_MARGIN = 12;
const deltaX = moveEvent.screenX - clickEvent.screenX;
const deltaY = moveEvent.screenY - clickEvent.screenY;

setPosition({
  x: inrange(
    x + deltaX,
    Math.floor(-boundary.width / 2 + box.width / 2 + BOUNDARY_MARGIN),
    Math.floor(boundary.width / 2 - box.width / 2 - BOUNDARY_MARGIN),
  ),
  y: inrange(
    y + deltaY,
    Math.floor(-boundary.height / 2 + box.height / 2 + BOUNDARY_MARGIN),
    Math.floor(boundary.height / 2 - box.height / 2 - BOUNDARY_MARGIN),
  ),
});
```

<br />
<br />

ì´ì œ drag elementê°€ **absolute**í•˜ë‹¤ê³  ìƒê°í•´ë³´ì.
ê¸°ë³¸ boxì˜ ìœ„ì¹˜ëŠ” boundaryì˜ ì¢Œìƒë‹¨(`x:0, y:0`) ì´ë‹¤.

ë”°ë¼ì„œ elementì˜ ì œí•œ ë²”ìœ„ë¥¼ ê³„ì‚°í•´ë³´ë©´
![](https://velog.velcdn.com/images/bepyan/post/1d9d532f-5d0d-45a4-93fc-b2eb12b6ada7/image.png)![](https://velog.velcdn.com/images/bepyan/post/173cb287-673d-478f-a24a-1a3eadf8b8ee/image.png)

ì¢Œì¸¡ ë = `margin`
ìš°ì¸¡ ë = `boundary.width` - `box.width` - `margin`

ì½”ë“œì— ì ìš©í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.
~~ì½”ë“œê°€ ë” ê¹”ë”í•œ ëŠë‚Œì€ ê¸°ë¶„íƒ“ì¸ê°€..~~

```tsx
const BOUNDARY_MARGIN = 12;
const deltaX = moveEvent.screenX - clickEvent.screenX;
const deltaY = moveEvent.screenY - clickEvent.screenY;

setPosition({
  x: inrange(
    x + deltaX,
    BOUNDARY_MARGIN,
    boundary.width - box.width - BOUNDARY_MARGIN
  ),
  y: inrange(
    y + deltaY,
    BOUNDARY_MARGIN
    boundary.height - box.height - BOUNDARY_MARGIN,
  ),
});
```

![](https://velog.velcdn.com/images/bepyan/post/65b91811-a409-4877-90aa-f589b5768ee8/image.gif)

ë­”ê°€ ê·¸ëŸ´ë“¯í•œ ê²°ê³¼ë¬¼ì´ ë‚˜ì™”ë‹¤ âœ¨âœ¨

---

## ì‘ìš© ë§ˆë¬´ë¦¬ â€” ìœ í‹¸ í•¨ìˆ˜ë¡œ ë§Œë“¤ê¸°

ê´€ë ¨ëœ ê¸°ëŠ¥ì„ ìœ í‹¸ í•¨ìˆ˜ë¡œ ì¶”ì¶œí•˜ë©´ ì‰½ê²Œ elementë¥¼ ì ìš©ì‹œí‚¬ ìˆ˜ ìˆì„ ê±° ê°™ë‹¤.

```tsx
export default function registMouseDownDrag(
  onDragChange: (deltaX: number, deltaY: number) => void,
  stopPropagation?: boolean,
) {
  return {
    onMouseDown: (clickEvent: React.MouseEvent<Element, MouseEvent>) => {
      if (stopPropagation) clickEvent.stopPropagation();

      const mouseMoveHandler = (moveEvent: MouseEvent) => {
        const deltaX = moveEvent.screenX - clickEvent.screenX;
        const deltaY = moveEvent.screenY - clickEvent.screenY;
        onDragChange(deltaX, deltaY);
      };

      const mouseUpHandler = () => {
        document.removeEventListener('mousemove', mouseMoveHandler);
      };

      document.addEventListener('mousemove', mouseMoveHandler);
      document.addEventListener('mouseup', mouseUpHandler, { once: true });
    },
  };
}
```

`stopPropagation` ê²½ìš° clickì´ë²¤íŠ¸ê°€ ì „íŒŒë˜ì§€ ì•Šê¸° ìœ„í•¨ì´ë‹¤.
ë¶€ëª¨ divì˜ clickì´ë²¤íŠ¸ê°€ ì‹¤í–‰ë˜ë©´ ê³¤ë€í•œ ê²½ìš°ê°€ ìˆë‹¤...

`onDragChange`ë¥¼ ì½œë²¡ìœ¼ë¡œ ë°›ì•„ì„œ ì‰½ê²Œ ì»¤ìŠ¤í„°ë§ˆì´ì§•ì„ í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.
ì½”ë“œì— ì‘ìš©í•´ë³´ì.

```tsx
const [{ x, y }, setPosition] = useState({
  x: 0,
  y: 0,
});
```

```tsx
<div
  style={{ left: x, top: y }}
  {...registMouseDownDrag((deltaX, deltaY) => {
    setConfig({
      x: x + deltaX,
      y: y + deltaY,
    });
  })}
  >
```

---

ì‹¤ì œ ë™ì‘ì€ ì•„ë˜ ë§í¬ì—ì„œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
https://dnd-playground.vercel.app/

style ì •ë³´, ì „ì²´ ì½”ë“œëŠ” ì•„ë˜ ê¹ƒí—ˆë¸Œì—ì„œ ì‚´í´ë³´ë©´ ë©ë‹ˆë‹¤.
https://github.com/bepyan/dnd-playground/
