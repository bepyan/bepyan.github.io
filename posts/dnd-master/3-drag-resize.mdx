---
title: 'Drag Resize ë½€ê°œê¸°'
description: 'ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ì´ Reactì—ì„œ element í¬ê¸°ë¥¼ dragí•´ì„œ ì¡°ì •í•˜ì!!!'
icon: ''
image: ''
tags:
  - Next.js
  - React
  - DOM
draft: false
date: 2022-10-03 15:01:48
---

[ì´ì „ í¬ìŠ¤íŠ¸](./2-drag-touch-event)ì—ì„œ ì—°êµ¬í•œ drag ì´ë²¤íŠ¸ë¥¼ í™œìš©í•˜ì—¬ Resize ê¸°ëŠ¥ì„ êµ¬í˜„í•´ë³´ì. 

## TL;DR

> [**getBoundingClientRect**](https://developer.mozilla.org/ko/docs/Web/API/Element/getBoundingClientRect)ë¥¼ í™œìš©í•˜ì—¬ ì—˜ë¦¬ë¨¼íŠ¸ì˜ í¬ê¸° ì •ë³´ë¥¼ ì–»ëŠ”ë‹¤.
> Drag ê±°ë¦¬ì— ë§ì¶° ì—˜ë¦¬ë¨¼íŠ¸ í¬ê¸°ë¥¼ ì¡°ì •í•´ì¤€ë‹¤.

---

## ë³µìŠµ â€” Drag ì´ë²¤íŠ¸ ë“±ë¡

DOM ì´ë²¤íŠ¸ë¥¼ í™œìš©í•˜ì—¬ ë§ˆìš°ìŠ¤ì˜ ì›€ì§ì„ì„ ì¶”ì í•œë‹¤.

1. í´ë¦­ì‹œ(`onMouseDown`) `document`ì— `mousemove` `mouseup` ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•œë‹¤.
2. elementì˜ í´ë¦­ ì´ë²¤íŠ¸ê°€ ë¶€ëª¨ë¡œ ì „íŒŒë˜ì§€ ì•Šê¸¸ ì›í•  ê²½ìš° `stopPropagation`ì„ í˜¸ì¶œí•œë‹¤.
3. í´ë¦­ëœ ìƒíƒœì—ì„œ ë§ˆìš°ìŠ¤ë¥¼ ì›€ì§ì¼ì‹œ `mousemove`ì— ë“±ë¡ ëœ í•¨ìˆ˜ê°€ ê³„ì† í˜¸ì¶œëœë‹¤.
4. í´ë¦­(`mousedown`) ì´ë²¤íŠ¸ ë°œìƒì‹œì˜ ë§ˆìš°ìŠ¤ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ,
   ì´ë™(`mousemove`) ì´ë²¤íŠ¸ì—ì„œ ìƒëŒ€ì ìœ¼ë¡œ ì´ë™í•œ ê±°ë¦¬(**deltaX**, **deltaY**)ë¥¼ ê³„ì‚°í•˜ê³ 
   ì½œë²¡ìœ¼ë¡œ ë°›ì€ `onDragChange`ì—ê²Œ ì „ë‹¬í•´ì¤€ë‹¤.
5. `mouseup` ì´ë²¤íŠ¸ì—ì„œ `mousemove` ì´ë²¤íŠ¸ë¥¼ ì œê±°í•œë‹¤.

```tsx
export default function registMouseDownDrag(
  onDragChange: (deltaX: number, deltaY: number) => void,
  stopPropagation?: boolean,
) {
  return {
    onMouseDown: (clickEvent: React.MouseEvent<Element, MouseEvent>) => {
      // 2ï¸âƒ£
      if (stopPropagation) clickEvent.stopPropagation();

      // 3ï¸âƒ£
      const mouseMoveHandler = (moveEvent: MouseEvent) => {
        // 4ï¸âƒ£
        const deltaX = moveEvent.screenX - clickEvent.screenX;
        const deltaY = moveEvent.screenY - clickEvent.screenY;
        onDragChange(deltaX, deltaY);
      };

      // 5ï¸âƒ£
      const mouseUpHandler = () => {
        document.removeEventListener('mousemove', mouseMoveHandler);
      };

      // 1ï¸âƒ£
      document.addEventListener('mousemove', mouseMoveHandler);
      document.addEventListener('mouseup', mouseUpHandler, { once: true });
    },
  };
}
```

---

## ê¸°ë³¸ ì‘ìš© â€” Dragë¡œ Resizeí•˜ê¸°

ë§ˆìš°ìŠ¤ì˜ ì›€ì§ì„ ë°”íƒ•ìœ¼ë¡œ elementì˜ sizeë¥¼ ì¡°ì •í•´ë³´ì.

1. elementì˜ `config`(ìœ„ì¹˜, í¬ê¸°) ìƒíƒœë¥¼ ì •ì˜í•œë‹¤.
2. elementì˜ `config`ì„ ì´ˆê¸°í™” í•œë‹¤.
   ë¤ìœ¼ë¡œ boundaryë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¤‘ì•™ì •ë ¬ì„ í•´ì£¼ì.
3. elementì˜ ìš°í•˜ë‹¨ì— resizeë¥¼ ë™ì‘ì‹œí‚¤ëŠ” ì˜ì—­ì„ ì •ì˜í•œë‹¤. ([tailwind](https://tailwindcss.com/)ë¥¼ ì‚¬ìš©í–ˆë‹¤.)
4. config ìƒíƒœë¥¼ ë³€ê²½í•˜ì—¬ elementì˜ í¬ê¸°ë¥¼ ë³€í™”ì‹œí‚¨ë‹¤.

```tsx
// 1ï¸âƒ£
const [{ x, y, w, h }, setConfig] = useState({
  x: 0,
  y: 0,
  w: 0,
  h: 0,
});

const boundaryRef = useRef<HTMLDivElement>(null);
// 2ï¸âƒ£
useEffect(() => {
  const boundary = boundaryRef.current?.getBoundingClientRect();

  if (boundary) {
    const DEFAULT_W = 240;
    const DEFAULT_H = 120;
    setConfig({
      x: Math.floor(boundary.width / 2 - DEFAULT_W / 2),
      y: Math.floor(boundary.height / 2 - DEFAULT_H / 2),
      w: DEFAULT_W,
      h: DEFAULT_H,
    });
  }
}, []);

return (
  <Boundary ref={boundaryRef}>
    <div style={{ width: w, height: h, left: x, top: y }} className="relative">
      <Box />
      <div
        // 3ï¸âƒ£
        className="absolute -bottom-0.5 left-3 right-3 h-2 cursor-s-resize"
        {...registMouseDownDrag((deltaX, deltaY) => {
          // 4ï¸âƒ£
          setConfig({
            x,
            y,
            w: w + deltaX,
            h: h + deltaY,
          });
        })}
      />
    </div>
  </Boundary>
);
```

![](https://velog.velcdn.com/images/bepyan/post/7e2b0964-cffa-4800-b2b5-7ccdb3b60b4d/image.gif)

---

## ì¶”ê°€ ì‘ìš© â€” Boundary ì ìš©

elementê°€ **ì›€ì§ì¼ ìˆ˜ ìˆëŠ” ë²”ìœ„**ë¥¼ ê³„ì‚°í•´ë³´ì.
![](https://velog.velcdn.com/images/bepyan/post/8c05b6c0-75e7-419d-9b68-ddc84cf4ff7f/image.png)

ì¢Œì¸¡ ë = `BOUNDARY_MARGIN`
ìš°ì¸¡ ë = `boundary.width` - `w` - `BOUNDARY_MARGIN`

<br />

ì, ì´ì œ elementê°€ **í™•ì¥í•  ìˆ˜ ìˆëŠ” ë²”ìœ„**ë¥¼ ê³„ì‚°í•´ë³´ì.
![](https://velog.velcdn.com/images/bepyan/post/089b4342-25bf-4e4f-926b-441a987bbfa9/image.png)

ìµœì†Œ width = `MIN_W`
ìµœëŒ€ width = `boundary.width` - `x` - `BOUNDARY_MARGIN`

<br />

ê·¸ë¦¼ì„ ê·¸ë ¤ë³´ë‹ˆ ìƒê°ë³´ë‹¤ ê°„ë‹¨í•˜ì§€ ì•ŠëŠ”ê°€?!
ì´ì œ ì•„ë˜ ì£¼ìš” ë¡œì§ì„ ë”°ë¼ ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ë„ë¡ í•˜ì.

1. position drag ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•´ì¤€ë‹¤.
2. `resize`ì˜ í´ë¦­ ì´ë²¤íŠ¸ê°€ ë¶€ëª¨ë¡œ ì „íŒŒë˜ì§€ ì•Šë„ë¡ `stopPropagation` í•´ì¤€ë‹¤.
3. `resize`ë˜ëŠ” ë²”ìœ„ë¥¼ ì˜ ì„¤ì •í•´ì¤€ë‹¤.

```tsx
const inrange = (v: number, min: number, max: number) => {
  if (v < min) return min;
  if (v > max) return max;
  return v;
};

const BOUNDARY_MARGIN = 12;
const MIN_W = 80;
const MIN_H = 80;
```

```tsx
<Boundary ref={boundaryRef}>
  <div
    style={{ width: w, height: h, left: x, top: y }}
    className="relative"
    // 1ï¸âƒ£
    {...registMouseDownDrag((deltaX, deltaY) => {
      if (!boundaryRef.current) return;

      const boundary = boundaryRef.current.getBoundingClientRect();
      setConfig({
        x: inrange(x + deltaX, BOUNDARY_MARGIN, boundary.width - w - BOUNDARY_MARGIN),
        y: inrange(y + deltaY, BOUNDARY_MARGIN, boundary.height - h - BOUNDARY_MARGIN),
        w,
        h,
      });
    }
  >
    <Box />
    <div
      className="absolute -bottom-0.5 left-3 right-3 h-2 cursor-s-resize"
	  style={{ backgroundColor: '#12121250' }}
      {...registMouseDownDrag((deltaX, deltaY) => {
        if (!boundaryRef.current) return;

        // 3ï¸âƒ£
        const boundary = boundaryRef.current.getBoundingClientRect();
        setConfig({
          x,
          y,
          w: inrange(w + deltaX, MIN_W, boundary.width - x - BOUNDARY_MARGIN),
          h: inrange(h + deltaY, MIN_H, boundary.height - y - BOUNDARY_MARGIN),
        });
      // 2ï¸âƒ£
      }, true)}
      />
  </div>
</Boundary>
```

![](https://velog.velcdn.com/images/bepyan/post/6c7c265f-5902-4602-8716-f4608794d847/image.gif)

ì˜¤í˜¸, ì´ ì •ë„ë©´ ì¢€ ì“¸ë§Œí•  ê²ƒ ê°™ë‹¤ ğŸ’ªğŸ¾

---

## ì‹¬í™” ì‘ìš© â€” ì—¬ëŸ¬ ë°©í–¥ì˜ Resize

ìš°ë¦¬ê°€ ë§ì´ ì ‘í•œ í¸ì§‘íˆ´ì€ ì¢Œìƒë‹¨, ìš°ìƒë‹¨, ì¢Œí•˜ë‹¨, ìš°í•˜ë‹¨ 4ê°€ì§€ ë°©í–¥ìœ¼ë¡œ Resizeí•  ìˆ˜ ìˆë‹¤.
ë‹¤ë¥¸ ë°©í–¥ìœ¼ë¡œ ì§„í–‰í•˜ê¸° ìœ„í•´ì„œ ë¬´ì—‡ì„ ê³ ë ¤í•´ì•¼í•˜ëŠ”ì§€ ì‚´í´ë³´ì.

**ì¢Œìƒë‹¨**ì¸ ê²½ìš°, ìš°í•˜ë‹¨ ë™ì‘ ë°©ì‹ê³¼ ì¢€ ë‹¤ë¥´ë‹¤.
`x`ê°€ ì¤„ì–´ë“œëŠ” ë§Œí¼ `w`ê°€ ì¦ê°€í•´ì•¼ì§€ ìœ„ì¹˜ê°€ ê³ ì •ëœ ìƒíƒœì—ì„œ element í¬ê¸°ê°€ ë‹¬ë¼ì§„ë‹¤.
ê·¸ë ‡ë‹¤ë©´ ì´ë“¤ì˜ ë²”ìœ„ë¥¼ ê³„ì‚°í•´ë³´ë„ë¡ í•˜ì.

![](https://velog.velcdn.com/images/bepyan/post/5420046d-0f19-4920-a573-21ddf35edf6b/image.png)

`maxX` = `x` + `w` - `MIN_W`
`maxWidth` = `x` + `w` - `BOUNDARY_MARGIN`

<br />

ì´ë¥¼ ì½”ë“œì— ì ìš©í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.
ì—¬ê¸°ì„œ `deltaX`ê°€ ì¤„ì–´ ë“¤ ë•Œ `width`ê°€ ì¦ê°€í•œë‹¤ëŠ” ì ì„ ë†“ì¹˜ì§€ ë§ì.
`width = w - deltaX`

```tsx
{/* ì¢Œìƒë‹¨ */}
<div
  className="absolute -top-1 -left-1 h-4 w-4 cursor-nw-resize"
  style={{ '#12121250' }}
  {...registMouseDownDrag((deltaX, deltaY) => {
    setConfig({
      x: inrange(x + deltaX, BOUNDARY_MARGIN, x + w - MIN_W),
      y: inrange(y + deltaY, BOUNDARY_MARGIN, y + h - MIN_H),
      w: inrange(w - deltaX, MIN_W, x + w - BOUNDARY_MARGIN),
      h: inrange(h - deltaY, MIN_H, y + h - BOUNDARY_MARGIN),
    });
  }, true)}
/>
```

ë‹¤ë¥¸ ë°©í–¥ì—ì„œì˜ ì›ë¦¬ë„ ì´ì™€ ë¹„ìŠ·í•˜ë‹¤.
ì ì ˆíˆ ì‘ìš©í•´ë³´ë„ë¡ í•˜ì.

```tsx
{
  /* ìš°ìƒë‹¨ */
}
<div
  className="absolute -top-1 -right-1 h-4 w-4 cursor-ne-resize"
  style={{ backgroundColor: '#12121250' }}
  {...registMouseDownDrag((deltaX, deltaY) => {
    if (!boundaryRef.current) return;

    const boundary = boundaryRef.current.getBoundingClientRect();

    setConfig({
      x,
      y: inrange(y + deltaY, BOUNDARY_MARGIN, y + h - MIN_H),
      w: inrange(w + deltaX, MIN_W, boundary.width - x - BOUNDARY_MARGIN),
      h: inrange(h - deltaY, MIN_H, y + h - BOUNDARY_MARGIN),
    });
  }, true)}
/>;

{
  /* ì¢Œí•˜ë‹¨ */
}
<div
  className="absolute -bottom-1 -left-1 h-4 w-4 cursor-ne-resize"
  style={{ backgroundColor: '#12121250' }}
  {...registMouseDownDrag((deltaX, deltaY) => {
    if (!boundaryRef.current) return;

    const boundary = boundaryRef.current.getBoundingClientRect();

    setConfig({
      x: inrange(x + deltaX, BOUNDARY_MARGIN, x + w - MIN_W),
      y,
      w: inrange(w - deltaX, MIN_W, x + w - BOUNDARY_MARGIN),
      h: inrange(h + deltaY, MIN_H, boundary.height - y - BOUNDARY_MARGIN),
    });
  }, true)}
/>;
```

![](https://velog.velcdn.com/images/bepyan/post/85f36f99-622d-432a-85ff-7c0443d80dfa/image.gif)

ìƒí•˜ì¢Œìš° ë°©í–¥ì€ ê·¸ì € í•˜ë“œì½”ë”©ì„ ì´ì–´ê°€ë©´ ëœë‹¤.
ê·¸ëŸ¼ ë‹¤ìŒ ê¸°ëŠ¥ ê°œë°œë¡œ ë„˜ì–´ê°€ë³´ì ğŸ„ğŸ»â€â™‚ï¸

---

ì‹¤ì œ ë™ì‘ì€ ì•„ë˜ ë§í¬ì—ì„œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
https://dnd-playground.vercel.app/resize

style ì •ë³´, ì „ì²´ ì½”ë“œëŠ” ì•„ë˜ ê¹ƒí—ˆë¸Œì—ì„œ ì‚´í´ë³´ë©´ ë©ë‹ˆë‹¤.
https://github.com/bepyan/dnd-playground/blob/main/src/components/DragSizeExample.tsx
